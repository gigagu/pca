    
{{ config(
    alias='prty12',
    materialized='table'
) }}

 -- 

 SELECT DISTINCT
  CONCAT(
    TRIM(CAST(SCI_ALL_SUBPROF.LSP_LE_ID AS STRING)),
    '-',
    TRIM(CAST(SCI_ALL_SUBPROF.LSP_ID AS STRING))
  ) AS PRTY_ID,
  'SCI' AS SRC_SYS,
  'XX' AS CTRY_CD,
  SCI_ALL_SUBPROF.ODS AS STRT_DT,
  '9999-12-31' AS END_DT,
  NULL AS PRTY_BIZ_TYPE_CD,
  NULL AS PRTY_CLTR_PLDG_RL_CD,
  NULL AS PRTY_INC_CTRY_CD,
  SCI_ALL_BKGLOC.BKL_CNTRY_ISO_CD AS PRTY_CR_RISK_RESP_CTRY_CD,
  NULL AS PRTY_CR_TEAM_CD,
  NULL AS DATA_SHR_CNST_FLG,
  'SubProfile' AS FILE_TYPE,
  SCI_ALL_SUBPROF.LSP_FM_APPR_RVW_DT AS PRTY_APPR_RVW_DT,
  NULL AS PRTY_FM_INDUSTRY_CD,
  NULL AS PRTY_GBL_RTNG_FLG,
  NULL AS GUARANTEED_BY_PRNT_FLG,
  NULL AS PRTY_HUB_LOC,
  SCI_ALL_SUBPROF.LSP_IFRS_CNTR_PARTY_VAL AS PRTY_IFRS_CP_TYPE_CD,
  SCI_ALL_SUBPROF.LSP_LANG_CD_VAL AS PRTY_LANG_CD,
  NULL AS PRTY_PRNT_SUPT_ELGT_CD,
  SCI_ALL_SUBPROF.LSP_SCB_AFFILIATE_CD_VAL AS PRTY_AFFL_CD,
  NULL AS PRTY_ANNL_SALES_AMT,
  NULL AS PRTY_ANNL_SALES_AMT_CCY,
  NULL AS PRTY_ANNL_INCOME_AMT,
  NULL AS PRTY_ANNL_INCOME_UPDT_DT,
  NULL AS PRTY_BKRPT_DT,
  NULL AS PRTY_BKRPT_FLG,
  NULL AS PRTY_BSL_SGMT_CD,
  NULL AS PRTY_BSL_SUB_SGMT_CD,
  NULL AS PRTY_BENEF_CP_CD,
  NULL AS PRTY_BIRTH_DT,
  NULL AS PRTY_BORROW_EXCP_FLG,
  'SubProfile' AS PRTY_CAT_CD,
  SCI_ALL_SUBPROF.LSP_CNTRY_CRDT_BKG_LOCTN_ID AS PRTY_CR_RISK_LOC_CD,
  NULL AS PRTY_CR_STS_CD,
  NULL AS PRTY_CRM_REF_NUM,
  NULL AS PRTY_DECSD_DT,
  NULL AS PRTY_DECSD_FLG,
  NULL AS PRTY_DCLR_INCOME_AMT,
  NULL AS PRTY_DLFT_CR_GRD_FLG,
  NULL AS PRTY_DLNQ_STRT_DT,
  NULL AS PRTY_DEPN_CNT,
  NULL AS PRTY_DESG_CD,
  SCI_ALL_SUBPROF.LSP_DCL_AGREE_DT AS PRTY_DSCL_AGMT_EFF_DT,
  SCI_ALL_SUBPROF.LSP_DCL_AGREE_IND AS PRTY_DSCL_AGMT_FLG,
  SCI_ALL_SUBPROF.LSP_DMCL_CNTRY_ISO_CD AS PRTY_DMCL_CTRY_CD,
  NULL AS PRTY_ED_LVL_CD,
  NULL AS PRTY_ELIG_FLG,
  NULL AS PRTY_EMPLR_NM,
  NULL AS PRTY_ENV_SR_GRD_CD,
  NULL AS PRTY_FIN_INST_CD,
  NULL AS PRTY_FM_CD,
  SCI_ALL_SUBPROF.LSP_FSA_RPRTNG_CLNT_VAL AS PRTY_FSA_RPT_CLNT_CD,
  NULL AS PRTY_GNDR_CD,
  NULL AS PRTY_INC_DT,
  NULL AS PRTY_INC_NUM,
  NULL AS PRTY_INST_CLAS_CD,
  NULL AS PRTY_INST_SCTR_CD,
  NULL AS PRTY_ISIC_CD,
  NULL AS PRTY_ISIC_CD_STRT_DT,
  NULL AS PRTY_ISIC_CD_WGHT,
  NULL AS PRTY_ISIC_TYPE,
  NULL AS PRTY_LGL_CONT_TYPE_CD,
  NULL AS PRTY_LGL_CONT_TYPE_DESC,
  SCI_ALL_SUBPROF.LSP_SUBPROF_NM AS PRTY_LGL_NM,
  NULL AS PRTY_LONG_NM,
  NULL AS PRTY_MRTL_STS,
  NULL AS PRTY_MODE_OF_SAL,
  NULL AS PRTY_MTH_ALLW_AMT,
  NULL AS PRTY_MTH_BSC_SAL_AMT,
  NULL AS PRTY_MTH_COMS_AMT,
  NULL AS PRTY_NTLTY_CTRY_CD,
  NULL AS PRTY_NATR_OF_BIZ,
  NULL AS PRTY_NET_WRTH_AMT,
  NULL AS PRTY_NEW_SGMT_CD,
  NULL AS PRTY_OCCP_CD,
  SCI_ALL_SUBPROF.LSP_ORGN_TP_VAL AS PRTY_ORG_TYPE_CD,
  NULL AS PRTY_OTH_BANK_CR_LMT_AMT,
  NULL AS PRTY_OTH_BANK_MTH_ILA_AMT,
  NULL AS PRTY_OTH_MTH_INCOME_AMT,
  NULL AS PRTY_POS_TITL,
  NULL AS PRTY_PRIME_BKR_FLG,
  NULL AS PRTY_PRFSN_CD,
  NULL AS PRTY_RL_END_DT,
  NULL AS PRTY_RL_INFO_VAL,
  NULL AS PRTY_ARM_CD,
  SCI_ALL_SUBPROF.LSP_REL_START_DT AS PRTY_RL_STRT_DT,
  NULL AS PRTY_RSDN_CTRY_CD,
  NULL AS PRTY_RSDNL_STS_CD,
  NULL AS PRTY_SALES_TURN_OVR_AMT,
  NULL AS PRTY_SALES_TURN_OVR_CCY,
  NULL AS PRTY_SCB_STAF_TYPE,
  NULL AS PRTY_SGMT_CD,
  NULL AS PRTY_SHORT_NM,
  NULL AS PRTY_STS_EFF_DT,
  SCI_ALL_SUBPROF.LSP_OPR_STS_2_VAL AS PRTY_STS_CD,
  NULL AS PRTY_SUB_SGMT_CD,
  NULL AS PRTY_TOT_WORK_EXPNC,
  NULL AS PRTY_TYPE_CD,
  NULL AS PRTY_SCB_CLAS_CD,
  NULL AS PRTY_SCB_ENT_FLG,
  NULL AS PRTY_SRC_PLDG_ID,
  NULL AS TOP_1000_BANK_IND,
  NULL AS PRTY_CFTC_CRCC_FLG,
  NULL AS PRTY_CORP_FLG,
  NULL AS PRTY_SME_FLG,
  NULL AS BKG_CTRY_CD,
  NULL AS COIN_NUM,
  NULL AS SALN_CD,
  NULL AS STAF_ID,
  NULL AS STAF_FLG,
  NULL AS MAND_CLRG_FLG,
  NULL AS PRTY_OPT_OUT_ANNL_FIL_FLG,
  NULL AS DF_PTCOL_2_SIDE_LTR_FLG,
  NULL AS PRTY_EUE_NOTC_FLG,
  NULL AS DF_PTCOL_2_SIDE_COMPL_FLG,
  NULL AS DF_ENT_CD,
  NULL AS SPL_ENT_FLG,
  NULL AS SPL_ENT_SUB_CAT,
  NULL AS QIR_FLG,
  NULL AS US_DMCL_FLG,
  NULL AS DF_ENT_SUB_TYPE,
  NULL AS FIN_ENT_EXCP_FLG,
  NULL AS INDUSTRY_RISK_CLAS_CD,
  NULL AS DF_COMPL_FLG,
  NULL AS ELIG_CONTR_PARTP_FLG,
  NULL AS INIT_MGRN_METH_CD,
  NULL AS DF_CTRY_CD,
  NULL AS RFL_STS_CD,
  SCI_ALL_SUBPROF.lsp_fm_appl_val AS FM_APPRT_CD,
  SCI_ALL_SUBPROF.verify_dt AS PRF_VFY_DT,
  SCI_ALL_SUBPROF.lsp_holdco_cd_val AS HLDCO_CD_VAL,
  CASE WHEN NOT ENTITY_FLG.PRTY_RL_ID IS NULL THEN 'T' ELSE NULL END AS PRTY_LGL_ENFRC_OFFSET_FLG,
  SCI_ALL_SUBPROF.fdp_last_processed_date AS REC_PRCS_DT,
  SCI_ALL_SUBPROF.fdp_is_rollover_flag AS REC_RLOVR_FLG,
  SCI_ALL_SUBPROF.LSP_CNTRY_CRDT_BKG_LOCTN_ID AS BKG_LOC_ID,
  SCI_ALL_SUBPROF.CREATE_DT AS CRT_DT,
  SCI_ALL_SUBPROF.prgrs_sts_val AS PRGS_STS_CD,
  CONCAT(SCI_ALL_BKGLOC.bkl_bkg_loctn_orgn_val, SCI_ALL_BKGLOC.BKL_CNTRY_ISO_CD) AS BKG_LOC_CD,
  SCI_ALL_SUBPROF.ODS AS ODS
FROM {{ source('sri_open_schema', 'sci_all_subprof') }} AS sci_all_subprof
LEFT OUTER JOIN {{ source('sri_open_schema', 'sci_all_bkgloc') }} AS sci_all_bkgloc
  ON SCI_ALL_SUBPROF.LSP_CNTRY_CRDT_BKG_LOCTN_ID = SCI_ALL_BKGLOC.BKL_SYS_GEN_BKG_LOCTN_ID
  AND SCI_ALL_SUBPROF.ODS = SCI_ALL_BKGLOC.ODS
  AND SCI_ALL_BKGLOC.ods = '{{ var('__ods_val__') }}'
LEFT OUTER JOIN (
  SELECT
    PRLTD.PRTY_ID,
    PRLTD.PRTY_RL_ID
  FROM {{ source('sri_open_schema', 'prty_rltd') }} AS PRLTD
  INNER JOIN {{ source('sri_open_schema', 'm_entity_setoff_xlate') }} AS ENTITY_SETOFF_XLATE
    ON PRLTD.PRTY_ID = ENTITY_SETOFF_XLATE.counterparty_id
  WHERE
    PRLTD.process_id_val = 'PRTY_RLTD-SCI-FMPROFINFO'
    AND PRLTD.ods_val = '{{ var('__ods_val__') }}'
    AND ENTITY_SETOFF_XLATE.ODS = '{{ var('__ods_val__') }}'
) AS ENTITY_FLG
  ON ENTITY_FLG.PRTY_RL_ID = CONCAT(
    TRIM(CAST(SCI_ALL_SUBPROF.LSP_LE_ID AS STRING)),
    '-',
    TRIM(CAST(SCI_ALL_SUBPROF.LSP_ID AS STRING))
  )
WHERE
  SCI_ALL_SUBPROF.ODS = '{{ var('__ods_val__') }}'
 